<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>MEGA - Controle de Estoque Pro</title>
    <style>
        :root { --primary: #0f766e; --bg: #f0fdfa; --text: #134e4a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .search-box { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1.1rem; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .qty-badge { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
        .btn-mov { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
        .btn-plus { background: #16a34a; }
        .btn-minus { background: #dc2626; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <a href="/" style="text-decoration:none;">â¬… Voltar</a>
        <h1>ðŸ“¦ Controle de Estoque (Sincronizado)</h1>
        <button onclick="carregarEstoque()" style="padding:10px;">ðŸ”„ Atualizar</button>
    </div>

    <input type="text" id="searchInput" class="search-box" placeholder="ðŸ” Buscar por SKU ou LocalizaÃ§Ã£o..." onkeyup="filtrar()">

    <table id="tabelaEstoque">
        <thead>
            <tr>
                <th>Produto / SKU</th>
                <th>LocalizaÃ§Ã£o</th>
                <th>Saldo Atual</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody id="corpoEstoque">
            </tbody>
    </table>
</div>

<script>
    let inventarioCompleto = [];

    async function carregarEstoque() {
        const res = await fetch('/api/estoque');
        inventarioCompleto = await res.json();
        renderizar();
    }

    function renderizar() {
        const termo = document.getElementById('searchInput').value.toUpperCase();
        const tbody = document.getElementById('corpoEstoque');
        tbody.innerHTML = "";

        const filtrados = inventarioCompleto.filter(item => 
            item.display.toUpperCase().includes(termo) || 
            (item.location && item.location.toUpperCase().includes(termo))
        );

        filtrados.forEach(item => {
            tbody.innerHTML += `
                <tr>
                    <td><strong>${item.display}</strong><br><small>${item.id}</small></td>
                    <td><span style="color:#666">${item.location || '---'}</span></td>
                    <td class="qty-badge">${item.qty}</td>
                    <td>
                        <button class="btn-mov btn-plus" onclick="movimentar('${item.id}', 'ENTRADA')">+</button>
                        <button class="btn-mov btn-minus" onclick="movimentar('${item.id}', 'SAIDA')">-</button>
                    </td>
                </tr>
            `;
        });
    }

    async function movimentar(sku, tipo) {
        const qtd = (tipo === 'SAIDA') ? 1 : 1; // Pode abrir prompt para qtd se quiser
        
        await fetch('/api/movimentar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sku, tipo, qtd, obs: 'Movimento via Painel' })
        });
        
        carregarEstoque(); // Atualiza apÃ³s salvar
    }

    carregarEstoque();
</script>
</body>
</html>
